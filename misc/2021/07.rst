=======
2021-07
=======

读毛剑《B站高可用架构实践》
===========================

:Date: 2021-07-18
:URL: https://zhuanlan.zhihu.com/p/139258985

.. glssary::

   BFE
      这里说的是 Bilibili Front End，理解为边缘节点的 proxy 即可

   SLE
      Server Load Balancing

   BFF
      Backend for Frontend

负载均衡
   - 前端负载均衡 以 DNS 为主

      - 尽量选择最近节点
      - 基于带宽策略调度选择 API 进入机房
      - 基于 *可用服务容量* 平衡流量

   - 数据中心内部负载均衡

      - 均衡流量分发
      - *可靠识别异常节点*
      - scale-out，增加同质节点以扩容
      - 减少错误，提高可用性

   为客户端分配 backend 子集：:search:`Deterministic Subsetting`

   JQS（最闲轮训）负载均衡算法

限流
   - 分布式限流： Quota Server
   - 客户端限流

   过载保护

重试
   - 要限制重试的次数，以及基于重试分布的策略
   - 只应该在失败层进行重试，当重试仍然失败时，我们需要全局约定错误码，避免级联重试
   - 使用随机化、指数型递增的充实周期，参考 Exponential Backoff 和 Jitter
   - 设定重试速率指标（？），用于诊断故障

   客户端限速

超时
   - 进程内超时控制
   - 跨进程超时控制（依赖 RPC 框架）
