=======
2020-01
=======

Migrating from GTK 3.x to GTK 4 [#]_
=====================================

列举 Srain 需要变更的部分：

Preparation in GTK 3.x
----------------------

Do not use widget style properties

Stop using GtkBox padding, fill and expand child properties
    GtkBox child properties 被 GtkWidget 的 properties 替代

Stop using ``gdk_pixbuf_get_from_window()`` and
    ``gdk_cairo_set_source_surface()``

Stop using GtkWidget event signals
    相关的 signal 被 event controllers key 和 gestures 替代

    ======================== =========================
    ``key-release-event``    ``GtkEventControllerKey``
    ``button-press-event``   ``GtkGesture``
    ``button-release-event`` ``GtkGesture``
    ======================== =========================

    *Custom widgets in GTK 4 – Input* [#]_ 给出了 event controller 的简单用法。

Reduce the use of ``gtk_widget_destroy()``
    使用更安全的 ``gtk_container_remove()`` 或 ``g_object_unref()``

    .. note:: ``gtk_container_remove()`` 不是已经废弃了吗？？？

Reduce the use of generic container APIs
    ``gtk_container_add()`` 和 ``gtk_container_remove()`` 已被移除，
    使用容器自带的 add 和 remove 函数

Changes that need to be done at the time of the switch
------------------------------------------------------

Subclassing
    Many widgets can no longer be subclassed. In most cases, 
    you should look deriving your widget directly from GtkWidget
    and use complex widgets as child widgets instead of deriving from them. 

Life-cycle handling
     The “destroy” signal can no longer be used to break reference cycles.

Stop using ``gtk_get_current_...`` APIs
     The function gtk_get_current_event() and its variants have been
     replaced by equivalent event controller APIs:
     ``gtk_event_controller_get_current_event()``, etc. 

Convert your ui files
    The :file:`gtk4-builder-tool` simplify command can perform many of the
    necessary changes automatically, when called with the ``–3to4`` option.

Adapt to GtkBuilder API changes
-------------------------------

太长不看

Changes to consider after the switch
------------------------------------

只有一个吗…… Orz

Consider porting to the new list widgets
    GTK 4 brings a new family of widgets for this purpose that uses list models
    instead of tree models, and widgets instead of cell renderers.
    See *List Widget Overview* [#]_


.. [#] https://developer.gnome.org/gtk4/unstable/gtk-migrating-3-to-4.html
.. [#] https://blog.gtk.org/2020/04/29/custom-widgets-in-gtk-4-input/
.. [#] https://developer.gnome.org/gtk4/unstable/ListContainers.html#ListWidget

Fzf Intro
=========

Fzf [#]_ 是一个命令行下通用模糊查找工具。通常搭配其他工具使用。

UI key binding
    - :kbd:`ctrl-j`, :kbd:`ctrl-k` 上下移动
    - :kbd:`enter` 选中, :kbd:`ctrl-c` 放弃
    - 多选模式(-m), 用 :kbd:`tab` 和 :kbd:`shift-tab` 多选
    - 其他的键位基本是 Emacs 风格
    - 支持鼠标

Search syntax

    ======= =========================== =======================================
    Token   Match type                  Description
    ------- --------------------------- ---------------------------------------
    sbtrkt  fuzzy-match                 Items that match sbtrkt
    'wild   exact-match (quoted)        Items that include wild
    ^music  prefix-exact-match          Items that start with music
    .mp3$   suffix-exact-match          Items that end with .mp3
    !fire   inverse-exact-match         Items that do not include fire
    !^music inverse-prefix-exact-match  Items that do not start with music
    !.mp3$  inverse-suffix-exact-match  Items that do not end with .mp3
    ======= =========================== =======================================

Shell key binding

    - :kbd:`**<tab>` 补全命令
    - :kbd:`ctrl-t` 补全文件
    - :kbd:`ctrl-r` 补全历史命令
    - :kbd:`alt-c` 补全目录

    .. note:: 根据配置可能会有所改变

.. [#] https://github.com/junegunn/fzf
